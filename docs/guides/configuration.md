# Configuration Guide

How to configure the engram plugin. The plugin works with zero
configuration using embedded SurrealKV. This guide covers customization
for other deployment modes and tuning behavior.

## Configuration File

The plugin reads configuration from `.claude/engram.local.md` in the
project root. This file uses YAML frontmatter for structured settings:

```markdown
---
# SurrealDB Memory Plugin Configuration
mode: embedded

connection:
  url: ws://localhost:8000
  username: root
  password: root
  namespace: memory
  database: default

local:
  data_path: .claude/engram/data
  engine: rocksdb
  port: 8000
  auto_start: true
  auto_stop: true

persistence:
  snapshot_on_stop: true
  snapshot_path: .claude/engram/snapshots
  max_snapshots: 5

memory:
  max_recall_results: 10
  decay_half_life_days: 7
  consolidation_threshold: 3
---

# SurrealDB Memory -- Local Configuration

This file was generated by `/memory-setup`. Edit the YAML frontmatter
above to change settings.
```

This file should NOT be committed to version control -- add
`.claude/engram.local.md` to `.gitignore`.

## Configuration Reference

### Top-Level

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `mode` | string | `embedded` | Deployment mode: `embedded`, `memory`, `local`, `docker`, `remote` |

### Connection Settings

Used by all deployment modes.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `connection.url` | string | -- | WebSocket URL (not needed for embedded mode) |
| `connection.username` | string | `root` | SurrealDB username |
| `connection.password` | string | `root` | SurrealDB password |
| `connection.namespace` | string | `memory` | SurrealDB namespace |
| `connection.database` | string | `default` | SurrealDB database name |

### Local Process Settings

For `embedded`, `memory`, and `local` modes where the plugin manages SurrealDB.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `local.data_path` | string | `.claude/engram/data` | Where to store database files |
| `local.engine` | string | `rocksdb` | Storage engine: `rocksdb` or `surrealkv` |
| `local.port` | number | `8000` | Port for local SurrealDB server |
| `local.auto_start` | boolean | `true` | Start SurrealDB on MCP server startup |
| `local.auto_stop` | boolean | `true` | Stop SurrealDB on MCP server shutdown |
| `local.pid_file` | string | `.claude/engram/surreal.pid` | PID file for process management |
| `local.log_level` | string | `info` | SurrealDB log level |
| `local.startup_timeout_ms` | number | `5000` | Max wait for SurrealDB to start |

### Docker Settings

For `docker` mode only.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `docker.container_name` | string | `engram` | Docker container name |
| `docker.image` | string | `surrealdb/surrealdb:latest` | Docker image |
| `docker.port` | number | `8000` | Host port mapping |
| `docker.data_path` | string | `.claude/engram/docker-data` | Volume mount path |
| `docker.auto_start` | boolean | `true` | Start container on MCP startup |
| `docker.auto_stop` | boolean | `false` | Stop container on MCP shutdown |
| `docker.restart_policy` | string | `unless-stopped` | Docker restart policy |

### Persistence Settings

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `persistence.snapshot_on_stop` | boolean | `true` | Export data when session ends (in-memory mode) |
| `persistence.snapshot_path` | string | `.claude/engram/snapshots` | Where to store snapshots |
| `persistence.export_format` | string | `surql` | Snapshot format: `surql` or `json` |
| `persistence.max_snapshots` | number | `5` | Number of snapshots to keep |

### Memory Behavior

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `memory.max_recall_results` | number | `10` | Max memories returned per recall query |
| `memory.session_token_budget` | number | `2000` | Max tokens for memory context injection |
| `memory.consolidation_threshold` | number | `3` | Consolidate after N related memories |
| `memory.decay_half_life_days` | number | `7` | Days before memory relevance halves |
| `memory.embedding_model` | string | `none` | Embedding model: `none`, `local`, `remote` (Phase 2) |

### Resilience Settings

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `resilience.health_check_interval_ms` | number | `30000` | Health check frequency |
| `resilience.reconnect_max_retries` | number | `5` | Max reconnection attempts |
| `resilience.reconnect_base_delay_ms` | number | `1000` | Initial reconnect delay (doubles each retry) |
| `resilience.reconnect_max_delay_ms` | number | `30000` | Max reconnect delay |
| `resilience.write_queue_max_size` | number | `100` | Max queued writes during outage |
| `resilience.fallback_to_file` | boolean | `true` | Queue writes to file if DB unreachable |

## Environment Variables

Environment variables override config file values. They also configure the MCP
server directly via `.mcp.json`.

| Variable | Maps to | Default |
|----------|---------|---------|
| `SURREAL_MODE` | `mode` | `embedded` |
| `SURREAL_DATA_PATH` | `local.data_path` | `~/.claude/engram/data` |
| `SURREAL_URL` | `connection.url` | -- |
| `SURREAL_USER` | `connection.username` | `root` |
| `SURREAL_PASS` | `connection.password` | `root` |
| `SURREAL_NS` | `connection.namespace` | `memory` |
| `SURREAL_DB` | `connection.database` | `default` |

Config values that contain `${ENV_VAR}` patterns are expanded at connection time.
This lets you reference secrets without hardcoding them:

```yaml
connection:
  username: ${SURREALDB_USER}
  password: ${SURREALDB_PASS}
```

## Config Resolution Order

Values resolve in this order (later overrides earlier):

1. **Built-in defaults** -- hardcoded in the MCP server (`mcp/src/index.ts`)
2. **Config file** -- `.claude/engram.local.md` frontmatter
3. **Environment variables** -- `SURREAL_*` prefix
4. **`${VAR}` expansion** -- values containing `${ENV_VAR}` are expanded last

## Example Configs by Deployment Mode

### Embedded SurrealKV (default -- no config file needed)

If you want to be explicit or change the data path:

```yaml
---
mode: embedded

local:
  data_path: ~/my-custom-path/surrealdb-data
---
```

### In-Memory with Snapshots

Data lives in memory during the session. Exported to a `.surql` file on session
end and imported on next start.

```yaml
---
mode: memory

local:
  port: 8000
  auto_start: true
  auto_stop: true

persistence:
  snapshot_on_stop: true
  snapshot_path: .claude/engram/snapshots
  max_snapshots: 5
---
```

### Local Server

A standalone SurrealDB process managed by the plugin:

```yaml
---
mode: local

connection:
  url: ws://localhost:8000
  username: root
  password: root
  namespace: memory
  database: default

local:
  data_path: .claude/engram/data
  engine: rocksdb
  port: 8000
  auto_start: true
  auto_stop: true
---
```

### Docker

SurrealDB runs in a Docker container:

```yaml
---
mode: docker

connection:
  url: ws://localhost:8000
  username: root
  password: root
  namespace: memory
  database: default

docker:
  container_name: engram
  image: surrealdb/surrealdb:latest
  port: 8000
  data_path: .claude/engram/docker-data
  auto_start: true
  auto_stop: false
---
```

### Remote / Cloud

Connect to SurrealDB Cloud or a self-hosted remote instance:

```yaml
---
mode: remote

connection:
  url: wss://my-instance.surrealdb.cloud
  username: ${SURREALDB_USER}
  password: ${SURREALDB_PASS}
  namespace: memory
  database: myproject
---
```

## Creating the Config File

You can create the config file manually, or use the `/memory-setup` command
(when available) which guides you through an interactive setup wizard that:

1. Detects your environment (SurrealDB binary, Docker, running instances)
2. Recommends the best deployment mode
3. Walks through mode-specific configuration
4. Tests the connection
5. Initializes the schema
6. Writes the config file

See [Deployment Modes](deployment-modes.md) for details on each mode.
